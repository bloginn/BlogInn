<!DOCTYPE HTML>
<html class="no-js">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="renderer" content="webkit">
<title>宗炳煌博客-</title>

<!-- 使用url函数转换相关路径 -->
<link rel="stylesheet" href="/css/themes/normalize.min.css">
<link rel="stylesheet" href="/css/themes/grid.css">
<link rel="stylesheet" href="/css/themes/style.css">
<link rel="stylesheet" href="/css/themes/responsive.css">
<link rel="stylesheet" href="/css/themes/fonts/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="">
<script type="text/javascript" src="/js/jquery.min.js"></script>
<meta name="description" content="宗炳煌博客 宗帅的博客" />
<meta name="keywords" content="宗炳煌 IT 宗炳煌博客 宗帅的博客 宗帅" />
</head>
<body class=" single single-post col-2cl page">

<!--[if lt IE 8]>
    <div class="browsehappy" role="dialog">当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.</div>
<![endif]-->
<div id="wrapper">
    <div id="wrapper-inner">
        <header id="header" class="group">
        <div class="slant-left">
        </div>
        <div class="slant-right">
        </div>
        <div class="container group">
            <div class="group pad">
                <p class="site-title">
                    <a href="/" rel="home">宗帅博客</a>
                </p>
                <p class="site-description">
                    一直想改变自己的命运和未来
                </p>
                <div class="clear">
                </div>
                <nav class="nav-container group" id="nav-header">
                <div class="nav-toggle">
                    <i class="fa fa-bars"></i>
                </div>
                <div class="nav-text">
                    <!-- put your mobile menu text here -->
                </div>
                <div class="nav-wrap container">
                    <ul class="nav group" id="menu-topbar-menu">
                        <li id="menu-item-0" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-0"><a href="/">首页</a></li>
                        <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1" id="menu-item-1"><a href="#">分类</a>
                        <ul class="sub-menu">
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1" id="menu-item-1"><a href="/sort/web/">前端设计</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2" id="menu-item-2"><a href="/sort/dev/">WEB开发</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3" id="menu-item-3"><a href="/sort/database/">数据库</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5" id="menu-item-5"><a href="/sort/server/">服务器</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-7" id="menu-item-7"><a href="/sort/c/">C语言</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-4" id="menu-item-4"><a href="/sort/ios/">MAC&iOS</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-21" id="menu-item-21"><a href="/sort/shell/">SHELL</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6" id="menu-item-6"><a href="/sort/tool/">IT杂谈</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77" id="menu-item-77"><a href="/sort/photography/">摄影</a></li>
                        </ul>
                        </li>
                        <li id="menu-item-2" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2"><a href="/about_lvtao.html">关于宗帅</a></li>
                        <li id="menu-item-3" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3"><a href="/lvtao_work.html">网站建设</a></li>
                        <li id="menu-item-453" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-453"><a href="/service.html">运维服务</a></li>
                    </ul>
                </div>
                </nav><!--/#nav-header-->
                <div class="slant-avatar">
                    <a href="/"><img src="/zongshuai.jpg" alt=""/></a>
                </div>
            </div>
            <!--/.pad-->
        </div>
        <!--/.container-->
        </header><!--/#header-->
        <div id="subheader">
            <div class="container">
            </div>
        </div>
        <!--/#subheader-->
        <div class="page-title group">
            <div class="container">
                <h2><a href="#">未知分类</a></h2>
            </div>
        </div>
        <!--/.page-title-->
        <div id="page">
            <div class="container group">
                <section class="content">
                <div class="post-time">
                    2016-08-19 12:25:00
                </div>
                <div class="pad group">
                    <article>
                    <h1 class="post-title">iptables防火墙详解</h1>
                    <div class="entry">
                    <p>&nbsp;</p>
<p>iptables常用命令</p>
<p>iptables -nv -L 查看iptables列表</p>
<p>iptables -F 清空iptables规则</p>
<p>iptables-save &gt; /etc/sysconfig/iptables 保存iptables规则到文件</p>
<p>service iptables restart 重启iptables</p>
<p>&nbsp;</p>
<p>以下是我服务器的iptables配置</p>
<div class='cnblogs_code'>
<pre><span style='color: #008000;'>#</span><span style='color: #008000;'> Generated by iptables-save v1.4.7 on Tue Jul  5 12:06:29 2016</span>
*<span style='color: #000000;'>filter
</span>:INPUT <span style='color: #0000ff;'>ACCEPT</span> [<span style='color: #800000;'>0</span>:<span style='color: #800000;'>0</span><span style='color: #000000;'>]
</span>:FORWARD <span style='color: #0000ff;'>ACCEPT</span> [<span style='color: #800000;'>0</span>:<span style='color: #800000;'>0</span><span style='color: #000000;'>]
</span>:OUTPUT <span style='color: #0000ff;'>ACCEPT</span> [<span style='color: #800000;'>4</span>:<span style='color: #800000;'>4940</span><span style='color: #000000;'>]
</span>-A INPUT -i lo -j <span style='color: #0000ff;'>ACCEPT #允许本地回环</span>
-A INPUT -m state --state RELATED,ESTABLISHED -j <span style='color: #0000ff;'>ACCEPT #允许服务器访问外网，例如curl,wget</span>
-A INPUT -p tcp -m tcp --dport <span style='color: #800000;'>80</span> -j <span style='color: #0000ff;'>ACCEPT #允许所有IP访问网站</span>
-A INPUT -p icmp -m icmp --icmp-type <span style='color: #800000;'>8</span> -j <span style='color: #0000ff;'>ACCEPT #允许ping请求</span>
-A INPUT -s <span style='color: #800000;'>61.149</span>.<span style='color: #800000;'>47.34</span>/<span style='color: #800000;'>32</span> -p tcp -m tcp --dport <span style='color: #800000;'>3306</span> -j <span style='color: #0000ff;'>ACCEPT #允许公司IP访问MySQL</span>
-A INPUT -s <span style='color: #800000;'>61.149</span>.<span style='color: #800000;'>47.34</span>/<span style='color: #800000;'>32</span> -p tcp -m tcp --dport <span style='color: #800000;'>6379</span> -j <span style='color: #0000ff;'>ACCEPT #允许公司IP访问Redis</span>
-A INPUT -p tcp -m multiport --dports <span style='color: #800000;'>8081</span>,<span style='color: #800000;'>10050</span>,<span style='color: #800000;'>65008</span> -j <span style='color: #0000ff;'>ACCEPT #允许所有IP访问8081,10050,65008端口，ps:65008是我的ssh端口</span>
-A INPUT -j REJECT --reject-with icmp-port-<span style='color: #000000;'>unreachable <span style='color: #0000ff;'>#拒绝所有的IP访问所有的端口</span></span><span style='color: #000000;'>
COMMIT
</span><span style='color: #008000;'>#</span><span style='color: #008000;'> Completed on Tue Jul  5 12:06:29 2016</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>防止攻击</p>
<div class='cnblogs_code'>
<pre><span style='color: #000000;'>防范DDOS攻击脚本
</span><span style='color: #008000;'>#</span><span style='color: #008000;'>防止DOS太多连接进来,可以允许外网网卡每个IP最多15个初始连接,超过的丢弃 </span>
iptables -A INPUT -i eth0 -p tcp --syn -m connlimit --connlimit-above <span style='color: #800000;'>15</span> -<span style='color: #000000;'>j DROP 
iptables </span>-A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j <span style='color: #0000ff;'>ACCEPT</span><span style='color: #000000;'>

防范CC攻击
(</span><span style='color: #800000;'>1</span><span style='color: #000000;'>)控制单个IP的最大并发连接数
iptables </span>-I INPUT -p tcp --dport <span style='color: #800000;'>80</span> -m connlimit  --connlimit-above <span style='color: #800000;'>50</span> -j REJECT <span style='color: #008000;'>#</span><span style='color: #008000;'>允许单个IP的最大连接数为 30</span>
(<span style='color: #800000;'>2</span><span style='color: #000000;'>)控制单个IP的某段时间的连接数
iptables </span>-A INPUT -p icmp -m limit --limit <span style='color: #800000;'>1</span>/m --limit-burst <span style='color: #800000;'>10</span> -<span style='color: #000000;'>j REJECT
iptables </span>-A INPUT -p icmp -j DROP</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>以下转载</p>
<p>&nbsp;</p>
<div><span style='color: #f00000; font-size: medium;'><strong>一：前言</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 防火墙，其实说白了讲，就是用于实现Linux下访问控制的功能的，它分为硬件的或者软件的防火墙两种。无论是在哪个网络中，防火墙工作的地方一定是在网络的边缘。而我们的任务就是需要去定义到底防火墙如何工作，这就是防火墙的策略，规则，以达到让它对出入网络的IP、数据进行检测。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 目前市面上比较常见的有3、4层的防火墙，叫<span style='color: #0000f0;'>网络层的防火墙</span>，还有7层的防火墙，其实是<span style='color: #0000f0;'>代理层的网关</span>。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 对于TCP/IP的七层模型来讲，我们知道第三层是网络层，三层的防火墙会在这层<span style='color: #0000f0;'>对源地址和目标地址进行检测</span>。但是对于七层的防火墙，不管你<span style='color: #0000f0;'>源端口或者目标端口，源地址或者目标地址是什么，都将对你所有的东西进行检查</span>。所以，对于设计原理来讲，七层防火墙更加安全，但是这却带来了效率更低。所以市面上通常的防火墙方案，都是两者结合的。而又由于我们都需要从防火墙所控制的这个口来访问，所以防火墙的工作效率就成了用户能够访问数据多少的一个最重要的控制，配置的不好甚至有可能成为流量的瓶颈。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>二：iptables 的历史以及工作原理</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.iptables的发展:</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables的前身叫ipfirewall （内核1.x时代）,这是一个作者从freeBSD上移植过来的，能够工作在内核当中的，对数据包进行检测的一款简易访问控制工具。但是ipfirewall工作功能极其有限(它需要将所有的规则都放进内核当中，这样规则才能够运行起来，而放进内核，这个做法一般是极其困难的)。当内核发展到2.x系列的时候，软件更名为ipchains，它可以定义多条规则，将他们串起来，共同发挥作用，而现在，它叫做iptables，可以<span style='color: #0000f0;'>将规则组成一个列表，实现绝对详细的访问控制功能</span>。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 他们都是工作在用户空间中，定义规则的工具，本身并不算是防火墙。它们定义的规则，可以<span style='color: #0000f0;'>让在内核空间当中的netfilter来读取</span>，并且实现让防火墙工作。而放入内核的地方必须要是特定的位置，必须是tcp/ip的协议栈经过的地方。而这个tcp/ip协议栈必须经过的地方，可以实现读取规则的地方就叫做 netfilter.(网络过滤器)</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 作者一共在内核空间中选择了5个位置，</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 1.内核空间中：从一个网络接口进来，到另一个网络接口去的</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 2.数据包从内核流入用户空间的</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 3.数据包从用户空间流出的</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 4.进入/离开本机的外网接口</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 5.进入/离开本机的内网接口</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.iptables的工作机制</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 从上面的发展我们知道了作者选择了5个位置，来作为控制的地方，但是你有没有发现，其实前三个位置已经基本上能将路径彻底封锁了，但是为什么已经在进出的口设置了关卡之后还要在内部卡呢？ 由于数据包尚未进行路由决策，还不知道数据要走向哪里，所以在进出口是没办法实现数据过滤的。所以要在内核空间里设置转发的关卡，进入用户空间的关卡，从用户空间出去的关卡。那么，既然他们没什么用，那我们为什么还要放置他们呢？因为我们<span style='color: #0000f0;'>在做NAT和DNAT的时候，目标地址转换必须在路由之前转换</span>。所以<span style='color: #0000f0;'>我们必须在外网而后内网的接口处进行设置关卡</span>。 &nbsp; &nbsp; &nbsp; &nbsp;</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;这五个位置也被称为五个钩子函数（hook functions）,也叫五个规则链。</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.PREROUTING (路由前)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 2.INPUT (数据包流入口)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 3.FORWARD (转发管卡)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 4.OUTPUT(数据包出口)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 5.POSTROUTING（路由后）</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; 这是NetFilter规定的五个规则链，任何一个数据包，只要经过本机，必将经过这五个链中的其中一个链。 &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>3.防火墙的策略</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 防火墙策略一般分为两种，一种叫&ldquo;通&rdquo;策略，一种叫&ldquo;堵&rdquo;策略，<span style='color: #0000f0;'>通策略，默认门是关着的，必须要定义谁能进</span>。<span style='color: #0000f0;'>堵策略则是，大门是洞开的，但是你必须有身份认证，否则不能进</span>。所以我们要定义，让进来的进来，让出去的出去，<span style='color: #0000f0;'>所以通，是要全通，而堵，则是要选择</span>。当我们定义的策略的时候，要分别定义多条功能，其中：定义数据包中允许或者不允许的策略，filter过滤的功能，而定义地址转换的功能的则是nat选项。为了让这些功能交替工作，我们制定出了&ldquo;表&rdquo;这个定义，来定义、区分各种不同的工作功能和处理方式。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 我们现在用的比较多个功能有3个：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.filter 定义允许或者不允许的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 2.nat 定义地址转换的&nbsp;</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3.mangle功能:修改报文原数据</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 我们修改报文原数据就是来修改TTL的。能够实现将数据包的元数据拆开，在里面做标记/修改内容的。而防火墙标记，其实就是靠mangle来实现的。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'>小扩展:</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 对于filter来讲一般只能做在3个链上：INPUT ，FORWARD ，OUTPUT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 对于nat来讲一般也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 而mangle则是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables/netfilter（这款软件）是工作在用户空间的，它可以让规则进行生效的，本身不是一种服务，而且规则是立即生效的。而我们iptables现在被做成了一个服务，可以进行启动，停止的。启动，则将规则直接生效，停止，则将规则撤销。&nbsp;</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables还支持自己定义链。但是自己定义的链，必须是跟某种特定的链关联起来的。在一个关卡设定，指定当有数据的时候专门去找某个特定的链来处理，当那个链处理完之后，再返回。接着在特定的链中继续检查。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span style='color: #800080;'>注意：</span>规则的次序非常关键，谁的<span style='color: #0000f0;'>规则越严格，应该放的越靠前</span>，而检查规则的时候，是按照从上往下的方式进行检查的。</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>三．规则的写法:</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables定义规则的方式比较复杂:</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;格式：iptables [-t table] COMMAND chain CRETIRIA -j ACTION</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-t table ：3个filter nat mangle</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;COMMAND：定义如何对规则进行管理</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;chain：指定你接下来的规则到底是在哪个链上操作的，当定义策略的时候，是可以省略的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;CRETIRIA:指定匹配标准</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-j ACTION :指定如何进行处理</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;比如：不允许172.16.0.0/24的进行访问。</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables -t filter -A INPUT -s 172.16.0.0/16 -p udp --dport 53 -j DROP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;当然你如果想拒绝的更彻底：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables -t filter -R INPUT 1 -s 172.16.0.0/16 -p udp --dport 53 -j REJECT</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables -L -n -v<span class='Apple-tab-span'> #查看定义规则的详细信息</span></span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>四：详解COMMAND:</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.链管理命令（这都是立即生效的）</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> -P :设置默认策略的（设定默认门是关着的还是开着的）</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 默认策略一般只有两种</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -P INPUT (DROP|ACCEPT) &nbsp;默认是关的/默认是开的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 比如：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -P INPUT DROP 这就把默认规则给拒绝了。并且没有定义哪个动作，所以关于外界连接的所有规则包括Xshell连接之类的，远程连接都被拒绝了。</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -F: FLASH，清空规则链的(注意每个链的管理权限)</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp; &nbsp; iptables -t nat -F PREROUTING</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp; &nbsp; iptables -t nat -F 清空nat表的所有链</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -N:NEW 支持用户新建一个链</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iptables -N inbound_tcp_web 表示附在tcp表上用于检查web的。</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -X: 用于删除用户自定义的空链</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 使用方法跟-N相同，但是在删除之前必须要将里面的链给清空昂了</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -E：用来Rename chain主要是用来给用户自定义的链重命名</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -E oldname newname</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Z：清空链，及链中默认规则的计数器的（有两个计数器，被匹配到多少个数据包，多少个字节）</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iptables -Z :清空</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.规则管理命令</strong></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A：追加，在当前链的最后新增一个规则</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-I num : 插入，把当前规则插入为第几条。</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -I 3 :插入为第三条</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-R num：Replays替换/修改第几条规则</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 格式：iptables -R 3 &hellip;&hellip;&hellip;&hellip;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-D num：删除，明确指定删除第几条规则</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>3.查看管理命令 &ldquo;-L&rdquo;</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;附加子命令</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-n：以数字的方式显示ip，它会将ip直接显示出来，如果不加-n，则会将ip反向解析成主机名。</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-v：显示详细信息</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-vv</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-vvv :越多越详细</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-x：在计数器上显示精确值，不做单位换算</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;--line-numbers : 显示规则的行号</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-t nat：显示所有的关卡的信息</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>五：详解匹配标准</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.通用匹配：源地址目标地址的匹配</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-s：指定作为源地址匹配，这里不能指定主机名称，必须是IP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> IP | IP/MASK | 0.0.0.0/0.0.0.0</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 而且地址可以取反，加一个&ldquo;!&rdquo;表示除了哪个IP之外</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-d：表示匹配目标地址</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-p：用于匹配协议的（这里的协议通常有3种，TCP/UDP/ICMP）</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-i eth0：从这块网卡流入的数据</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 流入一般用在INPUT和PREROUTING上</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-o eth0：从这块网卡流出的数据</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 流出一般在OUTPUT和POSTROUTING上</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.扩展匹配</strong></span></div>
<div><span style='color: #800080; font-size: medium;'>2.1隐含扩展：对协议的扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; -p tcp :TCP协议的扩展。一般有三种扩展</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --dport XX-XX：指定目标端口,不能指定多个非连续端口,只能指定单个端口，比如</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --dport 21 &nbsp;或者 --dport 21-23 (此时表示21,22,23)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --sport：指定源端口</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --tcp-fiags：TCP的标志位（SYN,ACK，FIN,PSH，RST,URG）</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp; &nbsp;&nbsp;对于它，一般要跟两个参数：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.检查的标志位</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 2.必须为1的标志位</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --tcpflags syn,ack,fin,rst syn &nbsp; = &nbsp; &nbsp;--syn</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 表示检查这4个位，这4个位中syn必须为1，其他的必须为0。所以这个意思就是用于检测三次握手的第一次包的。对于这种专门匹配第一包的SYN为1的包，还有一种简写方式，叫做--syn</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; -p udp：UDP协议的扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; --dport</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; --sport</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; -p icmp：icmp数据报文的扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; --icmp-type：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> echo-request(请求回显)，一般用8 来表示</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 所以 --icmp-type 8 匹配请求回显数据包</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> echo-reply （响应的数据包）一般用0来表示</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'>2.2显式扩展（-m）</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;扩展各种模块</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; -m multiport：表示启用多端口扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; 之后我们就可以启用比如 --dports 21,23,80</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>六：详解-j ACTION</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;常用的ACTION：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;DROP：悄悄丢弃</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 一般我们多用DROP来隐藏我们的身份，以及隐藏我们的链表</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;REJECT：明示拒绝</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;ACCEPT：接受</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> custom_chain：转向一个自定义的链</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;DNAT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;SNAT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;MASQUERADE：源地址伪装</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;REDIRECT：重定向：主要用于实现端口重定向</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;MARK：打防火墙标记的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;RETURN：返回</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 在自定义链执行完毕后使用返回，来返回原规则链。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>练习题1：</strong></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;只要是来自于172.16.0.0/16网段的都允许访问我本机的172.16.100.1的SSHD服务</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;分析：首先肯定是在允许表中定义的。因为不需要做NAT地址转换之类的，然后查看我们SSHD服务，在22号端口上，处理机制是接受，对于这个表，需要有一来一回两个规则，如果我们允许也好，拒绝也好，对于访问本机服务，我们最好是定义在INPUT链上，而OUTPUT再予以定义就好。(会话的初始端先定义)，所以加规则就是：</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;定义进来的： iptables -t filter -A INPUT -s 172.16.0.0/16 -d 172.16.100.1 -p tcp --dport 22 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;定义出去的： iptables -t filter -A OUTPUT -s 172.16.100.1 -d 172.16.0.0/16 -p tcp --dport 22 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;将默认策略改成DROP:</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;&nbsp;iptables -P INPUT DROP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;&nbsp;iptables -P OUTPUT DROP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;&nbsp;iptables -P FORWARD DROP</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>七：状态检测：</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 是一种显式扩展，用于检测会话之间的连接关系的，有了检测我们可以实现会话间功能的扩展</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; 什么是状态检测？对于整个TCP协议来讲，它是一个有连接的协议，三次握手中，第一次握手，我们就叫NEW连接，而从第二次握手以后的，ack都为1，这是正常的数据传输，和tcp的第二次第三次握手，叫做已建立的连接（ESTABLISHED）,还有一种状态，比较诡异的，比如：SYN=1 ACK=1 RST=1,对于这种我们无法识别的，我们都称之为INVALID无法识别的。还有第四种，FTP这种古老的拥有的特征，每个端口都是独立的，21号和20号端口都是一去一回，他们之间是有关系的，这种关系我们称之为RELATED。</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 所以我们的状态一共有四种：</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; NEW</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; ESTABLISHED</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; RELATED</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; INVALID</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 所以我们对于刚才的练习题，可以增加状态检测。比如进来的只允许状态为NEW和ESTABLISHED的进来，出去只允许ESTABLISHED的状态出去，这就可以将比较常见的反弹式木马有很好的控制机制。</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='font-size: medium;'>对于练习题的扩展：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 进来的拒绝出去的允许，进来的只允许ESTABLISHED进来，出去只允许ESTABLISHED出去。默认规则都使用拒绝</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -L -n --line-number &nbsp;：查看之前的规则位于第几行</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 改写INPUT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -R INPUT 2 -s 172.16.0.0/16 -d 172.16.100.1 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -R OUTPUT 1 -m state --state ESTABLISHED -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 此时如果想再放行一个80端口如何放行呢？</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -A INPUT -d 172.16.100.1 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -R INPUT 1 -d 172.16.100.1 -p udp --dport 53 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>练习题2：</strong></span></div>
<div><span style='font-size: medium;'>假如我们允许自己ping别人，但是别人ping自己ping不通如何实现呢？</span></div>
<div><span style='font-size: medium;'>分析：对于ping这个协议，进来的为8（ping），出去的为0(响应).我们为了达到目的，需要8出去,允许0进来</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>在出去的端口上：iptables -A OUTPUT -p icmp --icmp-type 8 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>在进来的端口上：iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>小扩展：对于127.0.0.1比较特殊，我们需要明确定义它</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -A OUTPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>八：SNAT和DNAT的实现</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 由于我们现在IP地址十分紧俏，已经分配完了，这就导致我们必须要进行地址转换，来节约我们仅剩的一点IP资源。那么通过iptables如何实现NAT的地址转换呢？</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.SNAT基于原地址的转换</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 基于原地址的转换一般用在我们的许多<span style='color: #0000f0;'>内网用户通过一个外网的口上网的时候，这时我们将我们内网的地址转换为一个外网的IP，我们就可以实现连接其他外网IP的功能</span>。</span></span></div>
<div><span style='font-size: medium;'>所以我们在iptables中就要定义到底如何转换：</span></div>
<div><span style='font-size: medium;'>定义的样式：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 比如我们现在要将所有192.168.10.0网段的IP在经过的时候全都转换成172.16.100.1这个假设出来的外网地址：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -j SNAT --to-source 172.16.100.1</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 这样，只要是来自本地网络的试图通过网卡访问网络的，都会被统统转换成172.16.100.1这个IP.</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 那么，如果172.16.100.1不是固定的怎么办？</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 我们都知道当我们使用联通或者电信上网的时候，一般它都会在每次你开机的时候随机生成一个外网的IP，意思就是外网地址是动态变换的。这时我们就要将外网地址换成 MASQUERADE(动态伪装):它可以实现自动寻找到外网地址，而自动将其改为正确的外网地址。所以，我们就需要这样设置：</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -j MASQUERADE</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;这里要注意：地址伪装并不适用于所有的地方。</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.DNAT目标地址转换</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> <span style='color: #0000f0;'>对于目标地址转换，数据流向是从外向内的，外面的是客户端，里面的是服务器端</span></span></span><span style='color: #0000f0;'>通过目标地址转换，我们可以让外面的ip通过我们对外的外网ip来访问我们服务器不同的服务器，而我们的服务却放在内网服务器的不同的服务器上</span>。</div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 如何做目标地址转换呢？：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -t nat -A PREROUTING -d 192.168.10.18 -p tcp --dport 80 -j DNAT --todestination 172.16.100.2</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; 目标地址转换要做在到达网卡之前进行转换,所以要做在PREROUTING这个位置上</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>九：控制规则的存放以及开启</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 注意：你所定义的所有内容，当你重启的时候都会失效，要想我们能够生效，需要使用一个命令将它保存起来</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.service iptables save 命令</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 它会保存在/etc/sysconfig/iptables这个文件中</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 2.iptables-save 命令</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables-save &gt; /etc/sysconfig/iptables</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 3.iptables-restore 命令</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 开机的时候，它会自动加载/etc/sysconfig/iptabels</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 如果开机不能加载或者没有加载，而你想让一个自己写的配置文件（假设为iptables.2）手动生效的话：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables-restore &lt; /etc/sysconfig/iptables.2</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 则完成了将iptables中定义的规则手动生效</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>十：总结</strong></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Iptables是一个非常重要的工具，它是每一个防火墙上几乎必备的设置，也是我们在做大型网络的时候，为了很多原因而必须要设置的。学好Iptables,可以让我们对整个网络的结构有一个比较深刻的了解，同时，我们还能够将内核空间中数据的走向以及linux的安全给掌握的非常透彻。我们在学习的时候，尽量能结合着各种各样的项目，实验来完成，这样对你加深iptables的配置，以及各种技巧有非常大的帮助。</span></div></div>
                    <!--/.entry-->
                    </article><!--/.post-->
                    <div class="clear">
                    </div>
                    <p class="post-tags">
                        <span>标签: </span><a href="#">CentOS</a>, <a href="#">Linux</a>, <a href="#">iptables</a>
                    </p>
                    <div class="clear">
                    </div>
                    <div class="clear">
                    </div>
                    <h4 class="heading">
                    <i class="fa fa-hand-o-right"></i>你可能还喜欢...
                    </h4>
                    <ul class="widget related-posts group thumbs-enabled" style="display: block;">
                        <li>
                        <div class="related-inner group post">
                            <h4 class="post-title"><a title="Linux日志文件总管——logrotate" rel="bookmark" href="#">Linux日志文件总管——logrotate</a></h4>
                            <p class="tab-item-date">
                                9 Aug, 2016
                            </p>
                        </div>
                        </li>
                        <li>
                        <div class="related-inner group post">
                            <h4 class="post-title"><a title="linux服务器沦陷后干嘛" rel="bookmark" href="#">linux服务器沦陷后干嘛</a></h4>
                            <p class="tab-item-date">
                                8 Jul, 2015
                            </p>
                        </div>
                        </li>
                        <li>
                        <div class="related-inner group post">
                            <h4 class="post-title"><a title="非法ip登录自动报警" rel="bookmark" href="#">非法ip登录自动报警</a></h4>
                            <p class="tab-item-date">
                                17 Jun, 2015
                            </p>
                        </div>
                        </li>
                    </ul>
                    <!-- <section id="comments" class="themeform">
                    <ul class="comment-tabs group">
                        <li class="active"><a href="#comments"><i class="fa fa-comments-o"></i>暂无评论</a></li>
                    </ul>
                    <div id="commentlist-container" class="comment-tab">
                    </div>
                    <div id="respond-post-38" class="respond">
                        <div class="cancel-comment-reply">
                            <a id="cancel-comment-reply-link" href="/server/38.html#respond-post-38" rel="nofollow" style="display:none" onclick="return TypechoComment.cancelReply();">取消回复</a>
                        </div>
                        <h3 id="reply-title">添加新评论</h3>
                        <form method="post" action="/server/38.html/comment" id="comment-form" class="comment-form" role="form">
                            <p>
                                <label for="textarea" class="required">内容</label>
                                <textarea rows="8" cols="50" name="text" id="textarea" class="textarea" required></textarea>
                            </p>
                            <p class="comment-form-author">
                                <label for="author" class="required">称呼 <span class="required">*</span></label>
                                <input type="text" name="author" id="author" class="text" value="" required/>
                            </p>
                            <p class="comment-form-email">
                                <label for="mail" class="required">Email</label>
                                <input type="email" name="mail" id="mail" class="text" value="" required/>
                            </p>
                            <p class="comment-form-url">
                                <label for="url">网站</label>
                                <input type="url" name="url" id="url" class="text" size="30" placeholder="http://" value=""/>
                            </p>
                            <p class="form-submit">
                                <button type="submit" class="submit">提交评论</button>
                            </p>
                        </form>
                    </div>
                    </section> --><!--/#comments-->
                </div>
                <!--/.pad-->
                </section><!--/.content-->
                <div class="sidebar s1 dark">
                    <a class="sidebar-toggle" title="展开侧栏"><i class="fa icon-sidebar-toggle"></i></a>
                    <div class="sidebar-content">
                        <ul class="post-nav group">
                            <li class="next"><a class="nextPage" href="#" title="强行停止已挂起的 Windows 服务相关的所有按钮都被禁用，包括启动、停止、暂停和恢复。"><i class="fa fa-chevron-right"></i><strong>下一篇</strong><span>下一篇</span></a></li>
                            <li class="previous"><a class="previousPage" href="#" title="Linux下查看文件和文件夹大小的df和du命令"><i class="fa fa-chevron-left"></i><strong>上一篇</strong><span>上一篇</span></a></li>
                        </ul>
                        <!-- 搜索 -->
                        <div class="widget widget_search" id="search-2">
                            <form action="./" class="searchform themeform" method="post" _lpchecked="1">
                                <div>
                                    <input type="text" value="输入搜索词后回车搜索" onfocus="if(this.value=='输入搜索词后回车搜索')this.value='';" onblur="if(this.value=='')this.value='输入搜索词后回车搜索';" name="s" class="search">
                                </div>
                            </form>
                        </div>
                        <div class="widget widget_alx_tabs" id="alxtabs-2">
                            <h3 class="group"><span>最新文章</span></h3>
                            <ul class="alx-tab group thumbs-enabled" id="tab-recent" style="display: block;">
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="Linux日志文件总管——logrotate" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">服务器</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">Linux日志文件总管——logrotate</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-08-09
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="苹果系统中Automator的使用教程" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">xcode&mac</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">苹果系统中Automator的使用教程</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-07-12
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="XtraFinder在 Mac OS 10.11上使用问题" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">xcode&mac</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">XtraFinder在 Mac OS 10.11上使用问题</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-07-12
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="Lock" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">Swift TIP</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">Lock</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-06-08
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="delegate" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">Swift TIP</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">delegate</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-06-08
                                    </p>
                                </div>
                                </li>
                            </ul>
                        </div>
                        <!-- <div class="widget widget_alx_tabs" id="alxtabs-3">
                            <h3 class="group"><span>最近评论</span></h3>
                            <div class="alx-tabs-container">
                                <ul class="alx-tab group avatars-enabled" id="tab-comments">
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/tool/640.html#comment-1909"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="memory" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            memory :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/tool/640.html#comment-1909">我也木有了~~~</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/ios/virtualbox_mac_setup.html#comment-1908"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="小马" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            小马 :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/ios/virtualbox_mac_setup.html#comment-1908">我的也是这样  win10 64b...</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/tool/640.html#comment-1907"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="fc4soda" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            fc4soda :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/tool/640.html#comment-1907">新gfwlist地址get，感谢楼主~</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/xcode-mac/automator.html#comment-1905"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="威客兼职" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            威客兼职 :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/xcode-mac/automator.html#comment-1905">真心觉得苹果机不好用，操作习惯和安...</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/server/224.html#comment-1904"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="lein" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            lein :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/server/224.html#comment-1904">1:2会生成16*256个字目录...
                                            </a>
                                        </div>
                                    </div>
                                    </li>
                                </ul>
                            </div>
                        </div> -->
                        <section class="widget">
                        <h3 class="widget-title">分类</h3>
                        <ul class="widget-list">
                            <li class="category-level-0 category-parent"><a href="#">前端设计</a></li>
                            <li class="category-level-0 category-parent"><a href="#">WEB开发</a></li>
                            <li class="category-level-0 category-parent"><a href="#">数据库</a></li>
                            <li class="category-level-0 category-parent"><a href="#">服务器</a>
                            <ul class="widget-list">
                                <li class="category-level-1 category-child category-level-odd"><a href="#">linux入门教程</a></li>
                                <li class="category-level-1 category-child category-level-odd"><a href="#">系统组件</a></li>
                                <li class="category-level-1 category-child category-level-odd"><a href="#">环境配置</a></li>
                            </ul>
                            </li>
                        </ul>
                        </section>
                    </div>
                    <!--/.sidebar-content-->
                </div>
                <!--/.sidebar-->
            </div>
            <!--/.container-->
        </div>
        <!--/#page-->
        <footer id="footer">
        <section class="container" id="footer-widgets">
<!--         <div class="pad group">
            <div class="footer-widget-1 grid one-third ">
                <div class="widget widget_recent_comments" id="recent-comments-2">
                    <h3 class="group"><span>最近评论</span></h3>
                    <ul id="recentcomments">
                        <li class="recentcomments"><span class="comment-author-link">memory</span><a href="/tool/640.html#comments">我也木有了~~~</a></li>
                        <li class="recentcomments"><span class="comment-author-link">小马</span><a href="/ios/virtualbox_mac_setup.html#comments">我的也是这样  win10 64bit系统  设置和本文一样  也是停留在starting d...</a></li>
                        <li class="recentcomments"><span class="comment-author-link">fc4soda</span><a href="/tool/640.html#comments">新gfwlist地址get，感谢楼主~</a></li>
                        <li class="recentcomments"><span class="comment-author-link">威客兼职</span><a href="/xcode-mac/automator.html#comments">真心觉得苹果机不好用，操作习惯和安卓的不一样</a></li>
                        <li class="recentcomments"><span class="comment-author-link">lein</span><a href="/server/224.html#comments">1:2会生成16*256个字目录
$cacheFile = $this->_cacheRoo...
                        </a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-widget-2 grid one-third ">
                <div class="widget widget_recent_entries" id="recent-posts-2">
                    <h3 class="group"><span>最新文章</span></h3>
                    <ul>
                        <li><a href="/server/logrotate.html">Linux日志文件总管——logrotate</a></li>
                        <li><a href="/xcode-mac/automator.html">苹果系统中Automator的使用教程</a></li>
                        <li><a href="/xcode-mac/1308.html">XtraFinder在 Mac OS 10.11上使用问题</a></li>
                        <li><a href="/tip/lock.html">Lock</a></li>
                        <li><a href="/tip/delegate.html">delegate</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-widget-3 grid one-third last">
                <div class="widget widget_hot_entries" id="hot-posts-2">
                    <h3 class="group"><span>最热文章</span></h3>
                    <ul>
                        <li><a href='/dev/php-socket-1.html' title='php的socket通信简记'>php的socket通信简记</a></li>
                        <li><a href='/server/windows-setup-tomcat.html' title='Windows操作系统下tomcat安装图文教程'>Windows操作系统下tomcat安装图文教程</a></li>
                        <li><a href='/tool/640.html' title='火狐FoxyProxy配置教程'>火狐FoxyProxy配置教程</a></li>
                        <li><a href='/ios/virtualbox_mac_setup.html' title='IOS开发学习之黑苹果:VirtualBOX安装Mac OS X 10.7正式版可完美升级 无bug 记录.'>IOS开发学习之黑苹果:VirtualBOX安装Mac OS X 10.7正式版可完美升级 无bug 记录.</a></li>
                        <li><a href='/dev/php-image-data-url.html' title='利用Data URL(data:image/jpg;base64,)将小图片生成数据流形式'>利用Data URL(data:image/jpg;base64,)将小图片生成数据流形式</a></li>
                    </ul>
                </div>
            </div>
        </div> -->
        <!--/.pad-->
        </section><!--/.container-->
        <section id="footer-bottom">
        <div class="container">
            <a id="back-to-top" href="#"><i class="fa fa-angle-up"></i></a>
            <div class="pad group">
                <div class="grid one-half">
                    <div id="copyright">
                        <p>
                            &copy; 2006-2016. All Rights Reserved.
                        </p>
                    </div>
                    <!--/#copyright-->
                    <div id="credit">
                        <p>
                            <a href="/">宗帅博客</a><a href="/feed/">文章 RSS</a><a href="/feed/comments/">评论 RSS</a><a href="/sitemap.xml" target="_blank">SiteMap</a>
                        </p>
                    </div>
                    <!--/#credit-->
                </div>
                <div class="grid one-half last">
                    <ul class="social-links">
                        <li><a rel="nofollow" title="新浪微博" class="social-tooltip" href="http://weibo.com/p/1005053750440417" target="_blank"><i class="fa fa-weibo"></i></a></li>
                        <li><a rel="nofollow" title="QQ" class="social-tooltip" href="http://wpa.qq.com/msgrd?v=3&uin=897579981&site=qq&menu=yes" target="_blank"><i class="fa fa-qq"></i></a></li>
                        <!-- <li><a rel="nofollow" title="GitHub" class="social-tooltip" href="https://github.com/lvtao320" target="_blank"><i class="fa fa-github"></i></a></li>
                        <li><a rel="nofollow" title="Facebook" class="social-tooltip" href="https://www.facebook.com/lvtao.net" target="_blank"><i class="fa fa-facebook"></i></a></li>
                        <li><a rel="nofollow" title="Twitter" class="social-tooltip" href="https://twitter.com/lvtao_net" target="_blank"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="/feed/" title="RSS Feed" class="social-tooltip" rel="nofollow"><i class="fa fa-rss"></i></a></li> -->
                    </ul>
                </div>
                <div class="statCode">
                </div>
            </div>
            <!--/.pad-->
        </div>
        </section><!--/.container-->
        </footer><!--/#footer-->
    </div>
    <!--/#wrapper-inner-->
</div>
<!--/#wrapper-->


</body>
<script type="text/javascript" src="/js/script.js"></script>
<script type="text/javascript" src=""></script>
</body>
</html>

<!DOCTYPE HTML>
<html class="no-js">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="renderer" content="webkit">
<title>宗炳煌博客-</title>

<!-- 使用url函数转换相关路径 -->
<link rel="stylesheet" href="/css/themes/normalize.min.css">
<link rel="stylesheet" href="/css/themes/grid.css">
<link rel="stylesheet" href="/css/themes/style.css">
<link rel="stylesheet" href="/css/themes/responsive.css">
<link rel="stylesheet" href="/css/themes/fonts/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="">
<script type="text/javascript" src="/js/jquery.min.js"></script>
<meta name="description" content="宗炳煌博客 宗帅的博客" />
<meta name="keywords" content="宗炳煌 IT 宗炳煌博客 宗帅的博客 宗帅" />
</head>
<body class=" single single-post col-2cl page">

<!--[if lt IE 8]>
    <div class="browsehappy" role="dialog">当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.</div>
<![endif]-->
<div id="wrapper">
    <div id="wrapper-inner">
        <header id="header" class="group">
        <div class="slant-left">
        </div>
        <div class="slant-right">
        </div>
        <div class="container group">
            <div class="group pad">
                <p class="site-title">
                    <a href="/" rel="home">宗帅博客</a>
                </p>
                <p class="site-description">
                    一直想改变自己的命运和未来
                </p>
                <div class="clear">
                </div>
                <nav class="nav-container group" id="nav-header">
                <div class="nav-toggle">
                    <i class="fa fa-bars"></i>
                </div>
                <div class="nav-text">
                    <!-- put your mobile menu text here -->
                </div>
                <div class="nav-wrap container">
                    <ul class="nav group" id="menu-topbar-menu">
                        <li id="menu-item-0" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-0"><a href="/">首页</a></li>
                        <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1" id="menu-item-1"><a href="#">分类</a>
                        <ul class="sub-menu">
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1" id="menu-item-1"><a href="/sort/web/">前端设计</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2" id="menu-item-2"><a href="/sort/dev/">WEB开发</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-3" id="menu-item-3"><a href="/sort/database/">数据库</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5" id="menu-item-5"><a href="/sort/server/">服务器</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-7" id="menu-item-7"><a href="/sort/c/">C语言</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-4" id="menu-item-4"><a href="/sort/ios/">MAC&iOS</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-21" id="menu-item-21"><a href="/sort/shell/">SHELL</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6" id="menu-item-6"><a href="/sort/tool/">IT杂谈</a></li>
                            <li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-77" id="menu-item-77"><a href="/sort/photography/">摄影</a></li>
                        </ul>
                        </li>
                        <li id="menu-item-2" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2"><a href="/about_lvtao.html">关于宗帅</a></li>
                        <li id="menu-item-3" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3"><a href="/lvtao_work.html">网站建设</a></li>
                        <li id="menu-item-453" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-453"><a href="/service.html">运维服务</a></li>
                    </ul>
                </div>
                </nav><!--/#nav-header-->
                <div class="slant-avatar">
                    <a href="/"><img src="/zongshuai.jpg" alt=""/></a>
                </div>
            </div>
            <!--/.pad-->
        </div>
        <!--/.container-->
        </header><!--/#header-->
        <div id="subheader">
            <div class="container">
            </div>
        </div>
        <!--/#subheader-->
        <div class="page-title group">
            <div class="container">
                <h2><a href="#">未知分类</a></h2>
            </div>
        </div>
        <!--/.page-title-->
        <div id="page">
            <div class="container group">
                <section class="content">
                <div class="post-time">
                    2016-08-19 12:25:00
                </div>
                <div class="pad group">
                    <article>
                    <h1 class="post-title">iptables防火墙详解</h1>
                    <div class="entry">
                    <p>&nbsp;</p>
<p>iptables常用命令</p>
<p>iptables -nv -L 查看iptables列表</p>
<p>iptables -F 清空iptables规则</p>
<p>iptables-save &gt; /etc/sysconfig/iptables 保存iptables规则到文件</p>
<p>service iptables restart 重启iptables</p>
<p>&nbsp;</p>
<p>以下是我服务器的iptables配置</p>
<div class='cnblogs_code'>
<pre><span style='color: #008000;'>#</span><span style='color: #008000;'> Generated by iptables-save v1.4.7 on Tue Jul  5 12:06:29 2016</span>
*<span style='color: #000000;'>filter
</span>:INPUT <span style='color: #0000ff;'>ACCEPT</span> [<span style='color: #800000;'>0</span>:<span style='color: #800000;'>0</span><span style='color: #000000;'>]
</span>:FORWARD <span style='color: #0000ff;'>ACCEPT</span> [<span style='color: #800000;'>0</span>:<span style='color: #800000;'>0</span><span style='color: #000000;'>]
</span>:OUTPUT <span style='color: #0000ff;'>ACCEPT</span> [<span style='color: #800000;'>4</span>:<span style='color: #800000;'>4940</span><span style='color: #000000;'>]
</span>-A INPUT -i lo -j <span style='color: #0000ff;'>ACCEPT #允许本地回环</span>
-A INPUT -m state --state RELATED,ESTABLISHED -j <span style='color: #0000ff;'>ACCEPT #允许服务器访问外网，例如curl,wget</span>
-A INPUT -p tcp -m tcp --dport <span style='color: #800000;'>80</span> -j <span style='color: #0000ff;'>ACCEPT #允许所有IP访问网站</span>
-A INPUT -p icmp -m icmp --icmp-type <span style='color: #800000;'>8</span> -j <span style='color: #0000ff;'>ACCEPT #允许ping请求</span>
-A INPUT -s <span style='color: #800000;'>61.149</span>.<span style='color: #800000;'>47.34</span>/<span style='color: #800000;'>32</span> -p tcp -m tcp --dport <span style='color: #800000;'>3306</span> -j <span style='color: #0000ff;'>ACCEPT #允许公司IP访问MySQL</span>
-A INPUT -s <span style='color: #800000;'>61.149</span>.<span style='color: #800000;'>47.34</span>/<span style='color: #800000;'>32</span> -p tcp -m tcp --dport <span style='color: #800000;'>6379</span> -j <span style='color: #0000ff;'>ACCEPT #允许公司IP访问Redis</span>
-A INPUT -p tcp -m multiport --dports <span style='color: #800000;'>8081</span>,<span style='color: #800000;'>10050</span>,<span style='color: #800000;'>65008</span> -j <span style='color: #0000ff;'>ACCEPT #允许所有IP访问8081,10050,65008端口，ps:65008是我的ssh端口</span>
-A INPUT -j REJECT --reject-with icmp-port-<span style='color: #000000;'>unreachable <span style='color: #0000ff;'>#拒绝所有的IP访问所有的端口</span></span><span style='color: #000000;'>
COMMIT
</span><span style='color: #008000;'>#</span><span style='color: #008000;'> Completed on Tue Jul  5 12:06:29 2016</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>防止攻击</p>
<div class='cnblogs_code'>
<pre><span style='color: #000000;'>防范DDOS攻击脚本
</span><span style='color: #008000;'>#</span><span style='color: #008000;'>防止DOS太多连接进来,可以允许外网网卡每个IP最多15个初始连接,超过的丢弃 </span>
iptables -A INPUT -i eth0 -p tcp --syn -m connlimit --connlimit-above <span style='color: #800000;'>15</span> -<span style='color: #000000;'>j DROP 
iptables </span>-A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j <span style='color: #0000ff;'>ACCEPT</span><span style='color: #000000;'>

防范CC攻击
(</span><span style='color: #800000;'>1</span><span style='color: #000000;'>)控制单个IP的最大并发连接数
iptables </span>-I INPUT -p tcp --dport <span style='color: #800000;'>80</span> -m connlimit  --connlimit-above <span style='color: #800000;'>50</span> -j REJECT <span style='color: #008000;'>#</span><span style='color: #008000;'>允许单个IP的最大连接数为 30</span>
(<span style='color: #800000;'>2</span><span style='color: #000000;'>)控制单个IP的某段时间的连接数
iptables </span>-A INPUT -p icmp -m limit --limit <span style='color: #800000;'>1</span>/m --limit-burst <span style='color: #800000;'>10</span> -<span style='color: #000000;'>j REJECT
iptables </span>-A INPUT -p icmp -j DROP</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>以下转载</p>
<p>&nbsp;</p>
<div><span style='color: #f00000; font-size: medium;'><strong>一：前言</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 防火墙，其实说白了讲，就是用于实现Linux下访问控制的功能的，它分为硬件的或者软件的防火墙两种。无论是在哪个网络中，防火墙工作的地方一定是在网络的边缘。而我们的任务就是需要去定义到底防火墙如何工作，这就是防火墙的策略，规则，以达到让它对出入网络的IP、数据进行检测。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 目前市面上比较常见的有3、4层的防火墙，叫<span style='color: #0000f0;'>网络层的防火墙</span>，还有7层的防火墙，其实是<span style='color: #0000f0;'>代理层的网关</span>。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 对于TCP/IP的七层模型来讲，我们知道第三层是网络层，三层的防火墙会在这层<span style='color: #0000f0;'>对源地址和目标地址进行检测</span>。但是对于七层的防火墙，不管你<span style='color: #0000f0;'>源端口或者目标端口，源地址或者目标地址是什么，都将对你所有的东西进行检查</span>。所以，对于设计原理来讲，七层防火墙更加安全，但是这却带来了效率更低。所以市面上通常的防火墙方案，都是两者结合的。而又由于我们都需要从防火墙所控制的这个口来访问，所以防火墙的工作效率就成了用户能够访问数据多少的一个最重要的控制，配置的不好甚至有可能成为流量的瓶颈。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>二：iptables 的历史以及工作原理</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.iptables的发展:</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables的前身叫ipfirewall （内核1.x时代）,这是一个作者从freeBSD上移植过来的，能够工作在内核当中的，对数据包进行检测的一款简易访问控制工具。但是ipfirewall工作功能极其有限(它需要将所有的规则都放进内核当中，这样规则才能够运行起来，而放进内核，这个做法一般是极其困难的)。当内核发展到2.x系列的时候，软件更名为ipchains，它可以定义多条规则，将他们串起来，共同发挥作用，而现在，它叫做iptables，可以<span style='color: #0000f0;'>将规则组成一个列表，实现绝对详细的访问控制功能</span>。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 他们都是工作在用户空间中，定义规则的工具，本身并不算是防火墙。它们定义的规则，可以<span style='color: #0000f0;'>让在内核空间当中的netfilter来读取</span>，并且实现让防火墙工作。而放入内核的地方必须要是特定的位置，必须是tcp/ip的协议栈经过的地方。而这个tcp/ip协议栈必须经过的地方，可以实现读取规则的地方就叫做 netfilter.(网络过滤器)</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 作者一共在内核空间中选择了5个位置，</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 1.内核空间中：从一个网络接口进来，到另一个网络接口去的</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 2.数据包从内核流入用户空间的</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 3.数据包从用户空间流出的</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 4.进入/离开本机的外网接口</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 5.进入/离开本机的内网接口</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.iptables的工作机制</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 从上面的发展我们知道了作者选择了5个位置，来作为控制的地方，但是你有没有发现，其实前三个位置已经基本上能将路径彻底封锁了，但是为什么已经在进出的口设置了关卡之后还要在内部卡呢？ 由于数据包尚未进行路由决策，还不知道数据要走向哪里，所以在进出口是没办法实现数据过滤的。所以要在内核空间里设置转发的关卡，进入用户空间的关卡，从用户空间出去的关卡。那么，既然他们没什么用，那我们为什么还要放置他们呢？因为我们<span style='color: #0000f0;'>在做NAT和DNAT的时候，目标地址转换必须在路由之前转换</span>。所以<span style='color: #0000f0;'>我们必须在外网而后内网的接口处进行设置关卡</span>。 &nbsp; &nbsp; &nbsp; &nbsp;</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;这五个位置也被称为五个钩子函数（hook functions）,也叫五个规则链。</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.PREROUTING (路由前)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 2.INPUT (数据包流入口)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 3.FORWARD (转发管卡)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 4.OUTPUT(数据包出口)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 5.POSTROUTING（路由后）</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; 这是NetFilter规定的五个规则链，任何一个数据包，只要经过本机，必将经过这五个链中的其中一个链。 &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>3.防火墙的策略</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 防火墙策略一般分为两种，一种叫&ldquo;通&rdquo;策略，一种叫&ldquo;堵&rdquo;策略，<span style='color: #0000f0;'>通策略，默认门是关着的，必须要定义谁能进</span>。<span style='color: #0000f0;'>堵策略则是，大门是洞开的，但是你必须有身份认证，否则不能进</span>。所以我们要定义，让进来的进来，让出去的出去，<span style='color: #0000f0;'>所以通，是要全通，而堵，则是要选择</span>。当我们定义的策略的时候，要分别定义多条功能，其中：定义数据包中允许或者不允许的策略，filter过滤的功能，而定义地址转换的功能的则是nat选项。为了让这些功能交替工作，我们制定出了&ldquo;表&rdquo;这个定义，来定义、区分各种不同的工作功能和处理方式。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 我们现在用的比较多个功能有3个：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.filter 定义允许或者不允许的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 2.nat 定义地址转换的&nbsp;</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3.mangle功能:修改报文原数据</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 我们修改报文原数据就是来修改TTL的。能够实现将数据包的元数据拆开，在里面做标记/修改内容的。而防火墙标记，其实就是靠mangle来实现的。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'>小扩展:</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 对于filter来讲一般只能做在3个链上：INPUT ，FORWARD ，OUTPUT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 对于nat来讲一般也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 而mangle则是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables/netfilter（这款软件）是工作在用户空间的，它可以让规则进行生效的，本身不是一种服务，而且规则是立即生效的。而我们iptables现在被做成了一个服务，可以进行启动，停止的。启动，则将规则直接生效，停止，则将规则撤销。&nbsp;</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables还支持自己定义链。但是自己定义的链，必须是跟某种特定的链关联起来的。在一个关卡设定，指定当有数据的时候专门去找某个特定的链来处理，当那个链处理完之后，再返回。接着在特定的链中继续检查。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span style='color: #800080;'>注意：</span>规则的次序非常关键，谁的<span style='color: #0000f0;'>规则越严格，应该放的越靠前</span>，而检查规则的时候，是按照从上往下的方式进行检查的。</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>三．规则的写法:</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables定义规则的方式比较复杂:</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;格式：iptables [-t table] COMMAND chain CRETIRIA -j ACTION</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-t table ：3个filter nat mangle</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;COMMAND：定义如何对规则进行管理</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;chain：指定你接下来的规则到底是在哪个链上操作的，当定义策略的时候，是可以省略的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;CRETIRIA:指定匹配标准</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-j ACTION :指定如何进行处理</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;比如：不允许172.16.0.0/24的进行访问。</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables -t filter -A INPUT -s 172.16.0.0/16 -p udp --dport 53 -j DROP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;当然你如果想拒绝的更彻底：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables -t filter -R INPUT 1 -s 172.16.0.0/16 -p udp --dport 53 -j REJECT</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;iptables -L -n -v<span class='Apple-tab-span'> #查看定义规则的详细信息</span></span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>四：详解COMMAND:</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.链管理命令（这都是立即生效的）</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> -P :设置默认策略的（设定默认门是关着的还是开着的）</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 默认策略一般只有两种</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -P INPUT (DROP|ACCEPT) &nbsp;默认是关的/默认是开的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 比如：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -P INPUT DROP 这就把默认规则给拒绝了。并且没有定义哪个动作，所以关于外界连接的所有规则包括Xshell连接之类的，远程连接都被拒绝了。</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -F: FLASH，清空规则链的(注意每个链的管理权限)</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp; &nbsp; iptables -t nat -F PREROUTING</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp; &nbsp; iptables -t nat -F 清空nat表的所有链</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -N:NEW 支持用户新建一个链</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iptables -N inbound_tcp_web 表示附在tcp表上用于检查web的。</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -X: 用于删除用户自定义的空链</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 使用方法跟-N相同，但是在删除之前必须要将里面的链给清空昂了</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; -E：用来Rename chain主要是用来给用户自定义的链重命名</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -E oldname newname</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-Z：清空链，及链中默认规则的计数器的（有两个计数器，被匹配到多少个数据包，多少个字节）</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iptables -Z :清空</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.规则管理命令</strong></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-A：追加，在当前链的最后新增一个规则</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-I num : 插入，把当前规则插入为第几条。</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -I 3 :插入为第三条</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-R num：Replays替换/修改第几条规则</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 格式：iptables -R 3 &hellip;&hellip;&hellip;&hellip;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-D num：删除，明确指定删除第几条规则</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>3.查看管理命令 &ldquo;-L&rdquo;</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;附加子命令</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-n：以数字的方式显示ip，它会将ip直接显示出来，如果不加-n，则会将ip反向解析成主机名。</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-v：显示详细信息</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-vv</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-vvv :越多越详细</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-x：在计数器上显示精确值，不做单位换算</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;--line-numbers : 显示规则的行号</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-t nat：显示所有的关卡的信息</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>五：详解匹配标准</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.通用匹配：源地址目标地址的匹配</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-s：指定作为源地址匹配，这里不能指定主机名称，必须是IP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> IP | IP/MASK | 0.0.0.0/0.0.0.0</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 而且地址可以取反，加一个&ldquo;!&rdquo;表示除了哪个IP之外</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-d：表示匹配目标地址</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-p：用于匹配协议的（这里的协议通常有3种，TCP/UDP/ICMP）</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-i eth0：从这块网卡流入的数据</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 流入一般用在INPUT和PREROUTING上</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;-o eth0：从这块网卡流出的数据</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 流出一般在OUTPUT和POSTROUTING上</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.扩展匹配</strong></span></div>
<div><span style='color: #800080; font-size: medium;'>2.1隐含扩展：对协议的扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; -p tcp :TCP协议的扩展。一般有三种扩展</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --dport XX-XX：指定目标端口,不能指定多个非连续端口,只能指定单个端口，比如</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --dport 21 &nbsp;或者 --dport 21-23 (此时表示21,22,23)</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --sport：指定源端口</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --tcp-fiags：TCP的标志位（SYN,ACK，FIN,PSH，RST,URG）</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp; &nbsp;&nbsp;对于它，一般要跟两个参数：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.检查的标志位</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 2.必须为1的标志位</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> --tcpflags syn,ack,fin,rst syn &nbsp; = &nbsp; &nbsp;--syn</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 表示检查这4个位，这4个位中syn必须为1，其他的必须为0。所以这个意思就是用于检测三次握手的第一次包的。对于这种专门匹配第一包的SYN为1的包，还有一种简写方式，叫做--syn</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; -p udp：UDP协议的扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; --dport</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; --sport</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; -p icmp：icmp数据报文的扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; --icmp-type：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> echo-request(请求回显)，一般用8 来表示</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 所以 --icmp-type 8 匹配请求回显数据包</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> echo-reply （响应的数据包）一般用0来表示</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'>2.2显式扩展（-m）</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;扩展各种模块</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; -m multiport：表示启用多端口扩展</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; 之后我们就可以启用比如 --dports 21,23,80</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>六：详解-j ACTION</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;常用的ACTION：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;DROP：悄悄丢弃</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 一般我们多用DROP来隐藏我们的身份，以及隐藏我们的链表</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;REJECT：明示拒绝</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;ACCEPT：接受</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> custom_chain：转向一个自定义的链</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;DNAT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;SNAT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;MASQUERADE：源地址伪装</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;REDIRECT：重定向：主要用于实现端口重定向</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;MARK：打防火墙标记的</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;RETURN：返回</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 在自定义链执行完毕后使用返回，来返回原规则链。</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>练习题1：</strong></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;只要是来自于172.16.0.0/16网段的都允许访问我本机的172.16.100.1的SSHD服务</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;分析：首先肯定是在允许表中定义的。因为不需要做NAT地址转换之类的，然后查看我们SSHD服务，在22号端口上，处理机制是接受，对于这个表，需要有一来一回两个规则，如果我们允许也好，拒绝也好，对于访问本机服务，我们最好是定义在INPUT链上，而OUTPUT再予以定义就好。(会话的初始端先定义)，所以加规则就是：</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;定义进来的： iptables -t filter -A INPUT -s 172.16.0.0/16 -d 172.16.100.1 -p tcp --dport 22 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;定义出去的： iptables -t filter -A OUTPUT -s 172.16.100.1 -d 172.16.0.0/16 -p tcp --dport 22 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp;将默认策略改成DROP:</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;&nbsp;iptables -P INPUT DROP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;&nbsp;iptables -P OUTPUT DROP</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> &nbsp;&nbsp;iptables -P FORWARD DROP</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>七：状态检测：</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 是一种显式扩展，用于检测会话之间的连接关系的，有了检测我们可以实现会话间功能的扩展</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; 什么是状态检测？对于整个TCP协议来讲，它是一个有连接的协议，三次握手中，第一次握手，我们就叫NEW连接，而从第二次握手以后的，ack都为1，这是正常的数据传输，和tcp的第二次第三次握手，叫做已建立的连接（ESTABLISHED）,还有一种状态，比较诡异的，比如：SYN=1 ACK=1 RST=1,对于这种我们无法识别的，我们都称之为INVALID无法识别的。还有第四种，FTP这种古老的拥有的特征，每个端口都是独立的，21号和20号端口都是一去一回，他们之间是有关系的，这种关系我们称之为RELATED。</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 所以我们的状态一共有四种：</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; NEW</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; ESTABLISHED</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; RELATED</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; INVALID</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 所以我们对于刚才的练习题，可以增加状态检测。比如进来的只允许状态为NEW和ESTABLISHED的进来，出去只允许ESTABLISHED的状态出去，这就可以将比较常见的反弹式木马有很好的控制机制。</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div><span style='font-size: medium;'>对于练习题的扩展：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 进来的拒绝出去的允许，进来的只允许ESTABLISHED进来，出去只允许ESTABLISHED出去。默认规则都使用拒绝</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -L -n --line-number &nbsp;：查看之前的规则位于第几行</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 改写INPUT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -R INPUT 2 -s 172.16.0.0/16 -d 172.16.100.1 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -R OUTPUT 1 -m state --state ESTABLISHED -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 此时如果想再放行一个80端口如何放行呢？</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -A INPUT -d 172.16.100.1 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; iptables -R INPUT 1 -d 172.16.100.1 -p udp --dport 53 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>练习题2：</strong></span></div>
<div><span style='font-size: medium;'>假如我们允许自己ping别人，但是别人ping自己ping不通如何实现呢？</span></div>
<div><span style='font-size: medium;'>分析：对于ping这个协议，进来的为8（ping），出去的为0(响应).我们为了达到目的，需要8出去,允许0进来</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>在出去的端口上：iptables -A OUTPUT -p icmp --icmp-type 8 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>在进来的端口上：iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>小扩展：对于127.0.0.1比较特殊，我们需要明确定义它</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -A OUTPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>八：SNAT和DNAT的实现</strong></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 由于我们现在IP地址十分紧俏，已经分配完了，这就导致我们必须要进行地址转换，来节约我们仅剩的一点IP资源。那么通过iptables如何实现NAT的地址转换呢？</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>1.SNAT基于原地址的转换</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 基于原地址的转换一般用在我们的许多<span style='color: #0000f0;'>内网用户通过一个外网的口上网的时候，这时我们将我们内网的地址转换为一个外网的IP，我们就可以实现连接其他外网IP的功能</span>。</span></span></div>
<div><span style='font-size: medium;'>所以我们在iptables中就要定义到底如何转换：</span></div>
<div><span style='font-size: medium;'>定义的样式：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 比如我们现在要将所有192.168.10.0网段的IP在经过的时候全都转换成172.16.100.1这个假设出来的外网地址：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -j SNAT --to-source 172.16.100.1</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 这样，只要是来自本地网络的试图通过网卡访问网络的，都会被统统转换成172.16.100.1这个IP.</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 那么，如果172.16.100.1不是固定的怎么办？</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 我们都知道当我们使用联通或者电信上网的时候，一般它都会在每次你开机的时候随机生成一个外网的IP，意思就是外网地址是动态变换的。这时我们就要将外网地址换成 MASQUERADE(动态伪装):它可以实现自动寻找到外网地址，而自动将其改为正确的外网地址。所以，我们就需要这样设置：</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iptables -t nat -A POSTROUTING -s 192.168.10.0/24 -j MASQUERADE</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;这里要注意：地址伪装并不适用于所有的地方。</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #800080; font-size: medium;'><strong>2.DNAT目标地址转换</strong></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> <span style='color: #0000f0;'>对于目标地址转换，数据流向是从外向内的，外面的是客户端，里面的是服务器端</span></span></span><span style='color: #0000f0;'>通过目标地址转换，我们可以让外面的ip通过我们对外的外网ip来访问我们服务器不同的服务器，而我们的服务却放在内网服务器的不同的服务器上</span>。</div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 如何做目标地址转换呢？：</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables -t nat -A PREROUTING -d 192.168.10.18 -p tcp --dport 80 -j DNAT --todestination 172.16.100.2</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; 目标地址转换要做在到达网卡之前进行转换,所以要做在PREROUTING这个位置上</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>九：控制规则的存放以及开启</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 注意：你所定义的所有内容，当你重启的时候都会失效，要想我们能够生效，需要使用一个命令将它保存起来</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 1.service iptables save 命令</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 它会保存在/etc/sysconfig/iptables这个文件中</span></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 2.iptables-save 命令</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables-save &gt; /etc/sysconfig/iptables</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; 3.iptables-restore 命令</span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 开机的时候，它会自动加载/etc/sysconfig/iptabels</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 如果开机不能加载或者没有加载，而你想让一个自己写的配置文件（假设为iptables.2）手动生效的话：</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> iptables-restore &lt; /etc/sysconfig/iptables.2</span></span></div>
<div><span style='font-size: medium;'><span class='Apple-tab-span'> 则完成了将iptables中定义的规则手动生效</span></span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='font-size: medium;'>&nbsp;</span></div>
<div><span style='color: #f00000; font-size: medium;'><strong>十：总结</strong></span></div>
<div><span style='font-size: medium;'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Iptables是一个非常重要的工具，它是每一个防火墙上几乎必备的设置，也是我们在做大型网络的时候，为了很多原因而必须要设置的。学好Iptables,可以让我们对整个网络的结构有一个比较深刻的了解，同时，我们还能够将内核空间中数据的走向以及linux的安全给掌握的非常透彻。我们在学习的时候，尽量能结合着各种各样的项目，实验来完成，这样对你加深iptables的配置，以及各种技巧有非常大的帮助。</span></div></div>
                    <!--/.entry-->
                    </article><!--/.post-->
                    <div class="clear">
                    </div>
                    <p class="post-tags">
                        <span>标签: </span><a href="#">CentOS</a>, <a href="#">Linux</a>, <a href="#">iptables</a>
                    </p>
                    <div class="clear">
                    </div>
                    <div class="clear">
                    </div>
                    <h4 class="heading">
                    <i class="fa fa-hand-o-right"></i>你可能还喜欢...
                    </h4>
                    <ul class="widget related-posts group thumbs-enabled" style="display: block;">
                        <li>
                        <div class="related-inner group post">
                            <h4 class="post-title"><a title="Linux日志文件总管——logrotate" rel="bookmark" href="#">Linux日志文件总管——logrotate</a></h4>
                            <p class="tab-item-date">
                                9 Aug, 2016
                            </p>
                        </div>
                        </li>
                        <li>
                        <div class="related-inner group post">
                            <h4 class="post-title"><a title="linux服务器沦陷后干嘛" rel="bookmark" href="#">linux服务器沦陷后干嘛</a></h4>
                            <p class="tab-item-date">
                                8 Jul, 2015
                            </p>
                        </div>
                        </li>
                        <li>
                        <div class="related-inner group post">
                            <h4 class="post-title"><a title="非法ip登录自动报警" rel="bookmark" href="#">非法ip登录自动报警</a></h4>
                            <p class="tab-item-date">
                                17 Jun, 2015
                            </p>
                        </div>
                        </li>
                    </ul>
                    <!-- <section id="comments" class="themeform">
                    <ul class="comment-tabs group">
                        <li class="active"><a href="#comments"><i class="fa fa-comments-o"></i>暂无评论</a></li>
                    </ul>
                    <div id="commentlist-container" class="comment-tab">
                    </div>
                    <div id="respond-post-38" class="respond">
                        <div class="cancel-comment-reply">
                            <a id="cancel-comment-reply-link" href="/server/38.html#respond-post-38" rel="nofollow" style="display:none" onclick="return TypechoComment.cancelReply();">取消回复</a>
                        </div>
                        <h3 id="reply-title">添加新评论</h3>
                        <form method="post" action="/server/38.html/comment" id="comment-form" class="comment-form" role="form">
                            <p>
                                <label for="textarea" class="required">内容</label>
                                <textarea rows="8" cols="50" name="text" id="textarea" class="textarea" required></textarea>
                            </p>
                            <p class="comment-form-author">
                                <label for="author" class="required">称呼 <span class="required">*</span></label>
                                <input type="text" name="author" id="author" class="text" value="" required/>
                            </p>
                            <p class="comment-form-email">
                                <label for="mail" class="required">Email</label>
                                <input type="email" name="mail" id="mail" class="text" value="" required/>
                            </p>
                            <p class="comment-form-url">
                                <label for="url">网站</label>
                                <input type="url" name="url" id="url" class="text" size="30" placeholder="http://" value=""/>
                            </p>
                            <p class="form-submit">
                                <button type="submit" class="submit">提交评论</button>
                            </p>
                        </form>
                    </div>
                    </section> --><!--/#comments-->
                </div>
                <!--/.pad-->
                </section><!--/.content-->
                <div class="sidebar s1 dark">
                    <a class="sidebar-toggle" title="展开侧栏"><i class="fa icon-sidebar-toggle"></i></a>
                    <div class="sidebar-content">
                        <ul class="post-nav group">
                            <li class="next"><a class="nextPage" href="#" title="强行停止已挂起的 Windows 服务相关的所有按钮都被禁用，包括启动、停止、暂停和恢复。"><i class="fa fa-chevron-right"></i><strong>下一篇</strong><span>下一篇</span></a></li>
                            <li class="previous"><a class="previousPage" href="#" title="Linux下查看文件和文件夹大小的df和du命令"><i class="fa fa-chevron-left"></i><strong>上一篇</strong><span>上一篇</span></a></li>
                        </ul>
                        <!-- 搜索 -->
                        <div class="widget widget_search" id="search-2">
                            <form action="./" class="searchform themeform" method="post" _lpchecked="1">
                                <div>
                                    <input type="text" value="输入搜索词后回车搜索" onfocus="if(this.value=='输入搜索词后回车搜索')this.value='';" onblur="if(this.value=='')this.value='输入搜索词后回车搜索';" name="s" class="search">
                                </div>
                            </form>
                        </div>
                        <div class="widget widget_alx_tabs" id="alxtabs-2">
                            <h3 class="group"><span>最新文章</span></h3>
                            <ul class="alx-tab group thumbs-enabled" id="tab-recent" style="display: block;">
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="Linux日志文件总管——logrotate" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">服务器</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">Linux日志文件总管——logrotate</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-08-09
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="苹果系统中Automator的使用教程" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">xcode&mac</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">苹果系统中Automator的使用教程</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-07-12
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="XtraFinder在 Mac OS 10.11上使用问题" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">xcode&mac</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">XtraFinder在 Mac OS 10.11上使用问题</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-07-12
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="Lock" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">Swift TIP</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">Lock</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-06-08
                                    </p>
                                </div>
                                </li>
                                <li>
                                <div class="tab-item-thumbnail">
                                    <a title="delegate" href="#">
                                    </a>
                                </div>
                                <div class="tab-item-inner group">
                                    <p class="tab-item-category">
                                        <a href="#">Swift TIP</a>
                                    </p>
                                    <p class="tab-item-title">
                                        <a title="{title}" rel="bookmark" href="#">delegate</a>
                                    </p>
                                    <p class="tab-item-date">
                                        2016-06-08
                                    </p>
                                </div>
                                </li>
                            </ul>
                        </div>
                        <!-- <div class="widget widget_alx_tabs" id="alxtabs-3">
                            <h3 class="group"><span>最近评论</span></h3>
                            <div class="alx-tabs-container">
                                <ul class="alx-tab group avatars-enabled" id="tab-comments">
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/tool/640.html#comment-1909"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="memory" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            memory :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/tool/640.html#comment-1909">我也木有了~~~</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/ios/virtualbox_mac_setup.html#comment-1908"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="小马" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            小马 :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/ios/virtualbox_mac_setup.html#comment-1908">我的也是这样  win10 64b...</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/tool/640.html#comment-1907"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="fc4soda" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            fc4soda :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/tool/640.html#comment-1907">新gfwlist地址get，感谢楼主~</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/xcode-mac/automator.html#comment-1905"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="威客兼职" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            威客兼职 :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/xcode-mac/automator.html#comment-1905">真心觉得苹果机不好用，操作习惯和安...</a>
                                        </div>
                                    </div>
                                    </li>
                                    <li>
                                    <div class="tab-item-avatar">
                                        <a href="/server/224.html#comment-1904"><img class="avatar" src="/css/themes/img/pt1.jpg "alt="lein" width="96" height="96"/></a>
                                    </div>
                                    <div class="tab-item-inner group">
                                        <div class="tab-item-name">
                                            lein :
                                        </div>
                                        <div class="tab-item-comment">
                                            <a href="/server/224.html#comment-1904">1:2会生成16*256个字目录...
                                            </a>
                                        </div>
                                    </div>
                                    </li>
                                </ul>
                            </div>
                        </div> -->
                        <section class="widget">
                        <h3 class="widget-title">分类</h3>
                        <ul class="widget-list">
                            <li class="category-level-0 category-parent"><a href="#">前端设计</a></li>
                            <li class="category-level-0 category-parent"><a href="#">WEB开发</a></li>
                            <li class="category-level-0 category-parent"><a href="#">数据库</a></li>
                            <li class="category-level-0 category-parent"><a href="#">服务器</a>
                            <ul class="widget-list">
                                <li class="category-level-1 category-child category-level-odd"><a href="#">linux入门教程</a></li>
                                <li class="category-level-1 category-child category-level-odd"><a href="#">系统组件</a></li>
                                <li class="category-level-1 category-child category-level-odd"><a href="#">环境配置</a></li>
                            </ul>
                            </li>
                        </ul>
                        </section>
                    </div>
                    <!--/.sidebar-content-->
                </div>
                <!--/.sidebar-->
            </div>
            <!--/.container-->
        </div>
        <!--/#page-->
        <footer id="footer">
        <section class="container" id="footer-widgets">
<!--         <div class="pad group">
            <div class="footer-widget-1 grid one-third ">
                <div class="widget widget_recent_comments" id="recent-comments-2">
                    <h3 class="group"><span>最近评论</span></h3>
                    <ul id="recentcomments">
                        <li class="recentcomments"><span class="comment-author-link">memory</span><a href="/tool/640.html#comments">我也木有了~~~</a></li>
                        <li class="recentcomments"><span class="comment-author-link">小马</span><a href="/ios/virtualbox_mac_setup.html#comments">我的也是这样  win10 64bit系统  设置和本文一样  也是停留在starting d...</a></li>
                        <li class="recentcomments"><span class="comment-author-link">fc4soda</span><a href="/tool/640.html#comments">新gfwlist地址get，感谢楼主~</a></li>
                        <li class="recentcomments"><span class="comment-author-link">威客兼职</span><a href="/xcode-mac/automator.html#comments">真心觉得苹果机不好用，操作习惯和安卓的不一样</a></li>
                        <li class="recentcomments"><span class="comment-author-link">lein</span><a href="/server/224.html#comments">1:2会生成16*256个字目录
$cacheFile = $this->_cacheRoo...
                        </a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-widget-2 grid one-third ">
                <div class="widget widget_recent_entries" id="recent-posts-2">
                    <h3 class="group"><span>最新文章</span></h3>
                    <ul>
                        <li><a href="/server/logrotate.html">Linux日志文件总管——logrotate</a></li>
                        <li><a href="/xcode-mac/automator.html">苹果系统中Automator的使用教程</a></li>
                        <li><a href="/xcode-mac/1308.html">XtraFinder在 Mac OS 10.11上使用问题</a></li>
                        <li><a href="/tip/lock.html">Lock</a></li>
                        <li><a href="/tip/delegate.html">delegate</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-widget-3 grid one-third last">
                <div class="widget widget_hot_entries" id="hot-posts-2">
                    <h3 class="group"><span>最热文章</span></h3>
                    <ul>
                        <li><a href='/dev/php-socket-1.html' title='php的socket通信简记'>php的socket通信简记</a></li>
                        <li><a href='/server/windows-setup-tomcat.html' title='Windows操作系统下tomcat安装图文教程'>Windows操作系统下tomcat安装图文教程</a></li>
                        <li><a href='/tool/640.html' title='火狐FoxyProxy配置教程'>火狐FoxyProxy配置教程</a></li>
                        <li><a href='/ios/virtualbox_mac_setup.html' title='IOS开发学习之黑苹果:VirtualBOX安装Mac OS X 10.7正式版可完美升级 无bug 记录.'>IOS开发学习之黑苹果:VirtualBOX安装Mac OS X 10.7正式版可完美升级 无bug 记录.</a></li>
                        <li><a href='/dev/php-image-data-url.html' title='利用Data URL(data:image/jpg;base64,)将小图片生成数据流形式'>利用Data URL(data:image/jpg;base64,)将小图片生成数据流形式</a></li>
                    </ul>
                </div>
            </div>
        </div> -->
        <!--/.pad-->
        </section><!--/.container-->
        <section id="footer-bottom">
        <div class="container">
            <a id="back-to-top" href="#"><i class="fa fa-angle-up"></i></a>
            <div class="pad group">
                <div class="grid one-half">
                    <div id="copyright">
                        <p>
                            &copy; 2006-2016. All Rights Reserved.
                        </p>
                    </div>
                    <!--/#copyright-->
                    <div id="credit">
                        <p>
                            <a href="/">宗帅博客</a><a href="/feed/">文章 RSS</a><a href="/feed/comments/">评论 RSS</a><a href="/sitemap.xml" target="_blank">SiteMap</a>
                        </p>
                    </div>
                    <!--/#credit-->
                </div>
                <div class="grid one-half last">
                    <ul class="social-links">
                        <li><a rel="nofollow" title="新浪微博" class="social-tooltip" href="http://weibo.com/p/1005053750440417" target="_blank"><i class="fa fa-weibo"></i></a></li>
                        <li><a rel="nofollow" title="QQ" class="social-tooltip" href="http://wpa.qq.com/msgrd?v=3&uin=897579981&site=qq&menu=yes" target="_blank"><i class="fa fa-qq"></i></a></li>
                        <!-- <li><a rel="nofollow" title="GitHub" class="social-tooltip" href="https://github.com/lvtao320" target="_blank"><i class="fa fa-github"></i></a></li>
                        <li><a rel="nofollow" title="Facebook" class="social-tooltip" href="https://www.facebook.com/lvtao.net" target="_blank"><i class="fa fa-facebook"></i></a></li>
                        <li><a rel="nofollow" title="Twitter" class="social-tooltip" href="https://twitter.com/lvtao_net" target="_blank"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="/feed/" title="RSS Feed" class="social-tooltip" rel="nofollow"><i class="fa fa-rss"></i></a></li> -->
                    </ul>
                </div>
                <div class="statCode">
                </div>
            </div>
            <!--/.pad-->
        </div>
        </section><!--/.container-->
        </footer><!--/#footer-->
    </div>
    <!--/#wrapper-inner-->
</div>
<!--/#wrapper-->


</body>
<script type="text/javascript" src="/js/script.js"></script>
<script type="text/javascript" src=""></script>
</body>
</html>

